import { HeroPattern } from '@/components/HeroPattern'

export const metadata = {
  title: 'Publishing Your Tool',
  description:
    'Learn how to package, publish to npm, and submit your tool to the Power Platform ToolBox registry',
}

export const sections = [
  { title: 'Prerequisites', id: 'prerequisites' },
  { title: 'Step 1: Prepare Your Package', id: 'step-1-prepare-your-package' },
  { title: 'Step 2: Build Your Tool', id: 'step-2-build-your-tool' },
  { title: 'Step 3: Finalize Package', id: 'step-3-finalize-package' },
  { title: 'Step 4: Publish to npm', id: 'step-4-publish-to-npm' },
  {
    title: 'Step 5: Test Published Version',
    id: 'step-5-test-published-version',
  },
  {
    title: 'Step 6: Submit to ToolBox Registry',
    id: 'step-6-submit-to-toolbox-registry',
  },
  { title: 'Versioning and Updates', id: 'versioning-and-updates' },
  { title: 'Best Practices', id: 'best-practices' },
  { title: 'Troubleshooting', id: 'troubleshooting' },
  { title: 'Next Steps', id: 'next-steps' },
  { title: 'Support', id: 'support' },
]

<HeroPattern />

# Publishing Your Tool

Once you've tested your tool locally and are ready to share it with the community, follow this guide to publish it to npm and submit it to the ToolBox registry. {{ className: 'lead' }}

## Prerequisites {{ anchor: true }}

Before publishing, ensure your tool:

- ✅ Builds successfully without errors
- ✅ Has been tested in local debug mode
- ✅ Follows the [Tool Development Guide](/tool-development)
- ✅ Has complete `package.json` metadata
- ✅ Has appropriate license (open source recommended)
- ✅ Has documentation (README.md)

## Step 1: Prepare Your Package {{ anchor: true }}

### Update package.json

Ensure all required fields are present:

```json
{
  "name": "@your-org/your-tool-name",
  "version": "1.0.0",
  "displayName": "Your Tool Name",
  "description": "Clear, concise description of what your tool does",
  "main": "index.html",
  "license": "MIT",
  "contributors": [
    {
      "name": "Your Name",
      "url": "https://yourwebsite.com"
    },
    {
      "name": "Additional Contributor(s)"
    }
  ],
  "configurations": {
    //Where your tool's source code lives and is used in the help menu of the app
    "repository": "https://github.com/yourusername/your-tool",
    //Optional
    "website": "https://the tool website or documentation URL",
    // This is used to display the README in ToolBox, and must be hosted
    // on raw.githubusercontent.com (optional but recommended)
    "readmeUrl": "https://raw.githubusercontent.com/yourusername/your-tool/refs/heads/main/README.md"
  },
  "cspExceptions": {
    //This is an optional section, do not include unless your tool needs to connect to more than dataverse endpoints
    "connect-src": [
      "websites that your tool needs to connect to, e.g.: www.api.example.com"
    ]
  },
  "features": {
    // Optional section to declare special features your tool needs
    "multiConnection": "optional" // or "required" if your tool needs multiple connections
  }
}
```

<Properties>
  <Property name="name" type="string" required>
    Package name (use scoped naming to differentiate your tool from others:
    `@org/tool-name`)
  </Property>
  <Property name="displayName" type="string" required>
    Human-readable name shown in ToolBox
  </Property>
  <Property name="description" type="string" required>
    Brief description (1-2 sentences)
  </Property>
  <Property name="main" type="string" required>
    Entry point file (usually `index.html`)
  </Property>
  <Property name="contributors" type="array" required>
    List of authors/contributors with names and optional URLs
  </Property>
  <Property name="license" type="string" required>
    License type (e.g., MIT, Apache-2.0) Must be an approved open-source
    license: MIT, Apache-2.0, BSD-2-Clause, BSD-3-Clause, GPL-2.0, GPL-3.0,
    LGPL-3.0, ISC, or AGPL-3.0-only (required)
  </Property>
  <Property name="configurations" type="object" required>
    Repository URL and optional website/documentation links
  </Property>
  <Property name="cspExceptions" type="object" optional>
    Content Security Policy exceptions if needed
  </Property>
  <Property name="features" type="object">
    Special features your tool requires (e.g., multiConnection)
  </Property>
</Properties>

## Step 2: Build Your Tool {{ anchor: true }}

Build your tool to create the distributable files:

```bash
npm run build
```

Verify that your `dist/` directory contains:

- `index.html` (entry point)
- All compiled JavaScript/CSS files
- Any required assets (images, icons, etc.)

## Step 3: Finalize Package {{ anchor: true }}

Run the finalization script to prepare your package:

```bash
npm run finalize-package
```

This ensures your package is ready for npm with correct file structure and dependencies.

## Step 4: Publish to npm {{ anchor: true }}

### First-Time Setup

If you haven't published to npm before:

```bash
# Create npm account (if needed)
npm login
```

### Publish Your Package

```bash
# For scoped packages
npm publish --access public

# For unscoped packages
npm publish
```

<Note>
  **Scoped packages** (e.g., `@myorg/tool-name`) require the `--access public`
  flag to be publicly accessible.
</Note>

### Verify Publication

Check that your package is live:

```bash
npm view @your-org/your-tool-name
```

Or visit: `https://www.npmjs.com/package/@your-org/your-tool-name`

## Step 5: Test Published Version {{ anchor: true }}

Before submitting to the registry, test your published npm package:

1. **Open Power Platform ToolBox**
2. **Navigate to Debug section**
3. **In "Install from npm" section:**
   - Enter your package name: `@your-org/your-tool-name`
   - Click **Install**
4. **Test thoroughly** to ensure everything works as expected

## Step 6: Submit to ToolBox Registry {{ anchor: true }}

Once your tool is working correctly from npm:

### Fill Out the Tool Submission Form

Visit the [Tool Submission Form](https://www.powerplatformtoolbox.com/submit-tool) (you need to login) and provide:

<Properties>
  <Property name="npm Package Name" type="string" required>
    Your published npm package name (e.g., `@your-org/tool-name`)
  </Property>

  <Property name="Tags/Categories" type="array" required>
    Select up to 3 from: Comparisons, Data, Development, Diagrams, Documentation, Environments, Migration, Solutions, Troubleshooting and Users & Security
  </Property>
</Properties>

### Automated Validation

After submission, automated checks will validate:

- ✅ npm package exists and is accessible
- ✅ Package contains appropriate metadata
- ✅ License is appropriate (open source preferred)
- ✅ No known security vulnerabilities
- ✅ Package structure is correct

### Manual Review

Maintainers will review your submission for:

- Security (no malicious code)
- Quality (follows guidelines)
- Functionality (works as described)
- Documentation (README is clear)

**Review typically takes 48-72 hours.**

## Versioning and Updates {{ anchor: true }}

### Semantic Versioning

Follow [Semantic Versioning](https://semver.org/):

- **Patch** (1.0.`X`): Bug fixes

  ```bash
  npm version patch
  ```

- **Minor** (1.`X`.0): New features (backward compatible)

  ```bash
  npm version minor
  ```

- **Major** (`X`.0.0): Breaking changes
  ```bash
  npm version major
  ```

### Publishing Updates

```bash
# Update version
npm version patch  # or minor, or major

# Build
npm run build

# Publish
npm publish --access public
```

<Note>
  The ToolBox registry automatically syncs with npm. Users will receive update
  notifications when new versions are published.
</Note>

## Best Practices {{ anchor: true }}

### Before Publishing

- ✅ Test thoroughly in debug mode
- ✅ Write comprehensive README with usage instructions
- ✅ Include screenshots or demo GIFs
- ✅ Document all features and limitations
- ✅ Add proper error handling
- ✅ Follow UI/UX guidelines for consistency

### After Publishing

- ✅ Monitor GitHub issues for bug reports
- ✅ Respond to user feedback promptly
- ✅ Keep dependencies up to date
- ✅ Maintain a CHANGELOG
- ✅ Provide migration guides for breaking changes
- ✅ Consider semantic versioning strictly

### Security

- ⚠️ Never include hardcoded credentials or API keys
- ⚠️ Validate all user inputs
- ⚠️ Use HTTPS for external API calls
- ⚠️ Don't access sensitive system resources
- ⚠️ Follow principle of least privilege

## Troubleshooting {{ anchor: true }}

### npm publish fails

**Error:** `You must be logged in to publish packages.`

**Solution:**

```bash
npm login
# Re-try publish
```

**Error:** `Package name too similar to existing package.`

**Solution:** Choose a more unique name or use scoped naming: `@your-org/tool-name`

### Tool not appearing in registry

**Check:**

1. Ensure automated validation passed
2. Check submission issue for maintainer feedback
3. Verify npm package is publicly accessible
4. Confirm package.json has all required fields

### Users reporting issues

**Steps:**

1. Reproduce the issue in debug mode
2. Fix in your local version
3. Update version number
4. Publish update to npm
5. Notify users in the issue thread

## Next Steps

<div className="not-prose mt-6 mb-16 flex gap-3">
  <Button href="/tool-development/best-practices" arrow="right">
    <>Best Practices</>
  </Button>
  <Button href="/tool-development/examples" variant="outline">
    <>View Examples</>
  </Button>
</div>

## Support

Need help publishing your tool?

- **GitHub Discussions:** [Ask the community](https://github.com/PowerPlatformToolBox/desktop-app/discussions)
- **Issues:** [Report problems](https://github.com/PowerPlatformToolBox/desktop-app/issues)
- **Documentation:** [Full tool dev guide](https://github.com/PowerPlatformToolBox/desktop-app/blob/main/docs/TOOL_DEV.md)
